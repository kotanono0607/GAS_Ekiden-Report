# ç¸¦æ–­é§…ä¼é¸æ‰‹åç°¿ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - è©³ç´°ä»•æ§˜æ›¸

## ç›®æ¬¡

1. [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](#1-ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦)
2. [ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#2-ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
3. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](#3-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ)
4. [GASãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ä»•æ§˜](#4-gasãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ä»•æ§˜)
5. [Webãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ä»•æ§˜](#5-webãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ä»•æ§˜)
6. [Streamlitã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä»•æ§˜](#6-streamlitã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä»•æ§˜)
7. [APIä»•æ§˜](#7-apiä»•æ§˜)
8. [ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆä»•æ§˜](#8-ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆä»•æ§˜)
9. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä»•æ§˜](#9-ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä»•æ§˜)

---

## 1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### 1.1 ã‚·ã‚¹ãƒ†ãƒ å
ç¸¦æ–­é§…ä¼é¸æ‰‹åç°¿ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

### 1.2 ã‚·ã‚¹ãƒ†ãƒ ã®ç›®çš„
é§…ä¼ãƒãƒ¼ãƒ ã®é¸æ‰‹æƒ…å ±ã€è¨˜éŒ²ã€ç›®æ¨™ã‚¿ã‚¤ãƒ ã‚’ä¸€å…ƒç®¡ç†ã—ã€åŒºé–“ã‚ªãƒ¼ãƒ€ãƒ¼ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚„è¨˜éŒ²åˆ†æã‚’è¡Œã†ãŸã‚ã®Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

### 1.3 ä¸»è¦æ©Ÿèƒ½
| æ©Ÿèƒ½ã‚«ãƒ†ã‚´ãƒª | æ©Ÿèƒ½å | èª¬æ˜ |
|-------------|--------|------|
| é¸æ‰‹ç®¡ç† | é¸æ‰‹ä¸€è¦§è¡¨ç¤º | ç™»éŒ²é¸æ‰‹ã®ä¸€è¦§ã‚’ã‚«ãƒ¼ãƒ‰å½¢å¼ã§è¡¨ç¤º |
| é¸æ‰‹ç®¡ç† | é¸æ‰‹è¿½åŠ /ç·¨é›† | é¸æ‰‹æƒ…å ±ã®ç™»éŒ²ãƒ»æ›´æ–° |
| é¸æ‰‹ç®¡ç† | é¸æ‰‹å‰Šé™¤ | è«–ç†å‰Šé™¤ã«ã‚ˆã‚‹é¸æ‰‹ã®ç„¡åŠ¹åŒ– |
| é¸æ‰‹ç®¡ç† | CSVä¸€æ‹¬ç™»éŒ² | CSVãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã®ä¸€æ‹¬ã‚¤ãƒ³ãƒãƒ¼ãƒˆ |
| è¨˜éŒ²ç®¡ç† | è¨˜éŒ²ç™»éŒ² | å¤§ä¼šè¨˜éŒ²ã®è¿½åŠ  |
| è¨˜éŒ²ç®¡ç† | è¨˜éŒ²ä¸€è¦§è¡¨ç¤º | é¸æ‰‹åˆ¥ã®è¨˜éŒ²å±¥æ­´è¡¨ç¤º |
| è¨˜éŒ²ç®¡ç† | è‡ªå·±ãƒ™ã‚¹ãƒˆè¨ˆç®— | ç¨®ç›®åˆ¥ãƒ™ã‚¹ãƒˆã‚¿ã‚¤ãƒ ã®è‡ªå‹•ç®—å‡º |
| åˆ†ææ©Ÿèƒ½ | è¨˜éŒ²æ¨ç§»ã‚°ãƒ©ãƒ• | æ™‚ç³»åˆ—ã§ã®è¨˜éŒ²å¤‰åŒ–ã‚’ã‚°ãƒ©ãƒ•åŒ– |
| åˆ†ææ©Ÿèƒ½ | ç›®æ¨™é”æˆåº¦è¨ˆç®— | ç›®æ¨™ã‚¿ã‚¤ãƒ ã¨ã®å·®åˆ†ã‚’è¡¨ç¤º |
| ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | åŒºé–“ã‚ªãƒ¼ãƒ€ãƒ¼ç·¨æˆ | ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§åŒºé–“é…ç½® |
| ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | ç·åˆã‚¿ã‚¤ãƒ äºˆæ¸¬ | é…ç½®ã«åŸºã¥ãäºˆæƒ³ã‚¿ã‚¤ãƒ è¨ˆç®— |
| ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä¿å­˜ | ç·¨æˆæ¡ˆã®ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿ |

### 1.4 å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¨®åˆ¥ | èª¬æ˜ | æ¨©é™ |
|-------------|------|------|
| ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ | ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã€ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ | é–²è¦§ã€è¨˜éŒ²è¿½åŠ ã€ç›®æ¨™ç·¨é›† |
| ç®¡ç†è€… | ç›£ç£ã€ã‚³ãƒ¼ãƒ | å…¨æ©Ÿèƒ½ï¼ˆé¸æ‰‹è¿½åŠ /ç·¨é›†/å‰Šé™¤å«ã‚€ï¼‰ |

---

## 2. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 2.1 å…¨ä½“æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå±¤                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   GAS Webã‚¢ãƒ—ãƒª      â”‚         Streamlit ã‚¢ãƒ—ãƒª                   â”‚
â”‚   (HTML/CSS/JS)     â”‚         (Python)                          â”‚
â”‚   - index.html      â”‚         - app.py                          â”‚
â”‚   - simulation.html â”‚         - pages/1_é¸æ‰‹ä¸€è¦§.py              â”‚
â”‚   - csv.html        â”‚         - pages/2_é¸æ‰‹è©³ç´°.py              â”‚
â”‚   - javascript.html â”‚         - pages/3_è¨˜éŒ²å…¥åŠ›.py              â”‚
â”‚   - stylesheet.html â”‚                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                           â”‚
           â”‚ google.script.run         â”‚ gspread API
           â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å±¤                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Google Apps Script â”‚         Google Cloud Run                  â”‚
â”‚   (ã‚³ãƒ¼ãƒ‰.js)        â”‚         (Dockerã‚³ãƒ³ãƒ†ãƒŠ)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                           â”‚
           â”‚ SpreadsheetApp            â”‚ Google Sheets API
           â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ãƒ‡ãƒ¼ã‚¿å±¤                                    â”‚
â”‚              Google Spreadsheet (ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹)                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚ Players â”‚  â”‚ Records â”‚  â”‚TeamRecordsâ”‚  â”‚Simulations â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³/ä»•æ§˜ |
|---------|------|----------------|
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (GAS) | HTML5, CSS3, JavaScript | ES6+ |
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (Streamlit) | Streamlit | >= 1.28.0 |
| ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | Google Apps Script | V8 Runtime |
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | Google Spreadsheet | - |
| èªè¨¼ | OAuth 2.0 | Googleèªè¨¼ |
| ã‚°ãƒ©ãƒ•æç”» | Chart.js (GAS) / Plotly (Streamlit) | - |
| ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ— | SortableJS | 1.15.0 |
| ã‚³ãƒ³ãƒ†ãƒŠ | Docker | Python 3.9-slim |
| ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚° | GAS Web App / Cloud Run / Hugging Face Spaces | - |

### 2.3 ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
GAS_Ekiden-Report/
â”œâ”€â”€ .clasp.json                 # claspè¨­å®šï¼ˆGASãƒ‡ãƒ—ãƒ­ã‚¤ç”¨ï¼‰
â”œâ”€â”€ appsscript.json             # GASãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
â”œâ”€â”€ ã‚³ãƒ¼ãƒ‰.js                    # GASãƒ¡ã‚¤ãƒ³ã‚³ãƒ¼ãƒ‰ï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ï¼‰
â”œâ”€â”€ index.html                  # ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸HTML
â”œâ”€â”€ javascript.html             # JavaScriptï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ï¼‰
â”œâ”€â”€ stylesheet.html             # CSS ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆ
â”œâ”€â”€ simulation.html             # ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒšãƒ¼ã‚¸
â”œâ”€â”€ csv.html                    # CSVç™»éŒ²ãƒšãƒ¼ã‚¸
â”œâ”€â”€ ekiden_profile_v1.html      # ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆå‚è€ƒç”¨ï¼‰
â”œâ”€â”€ Dockerfile                  # Cloud Runç”¨Dockerfile
â”œâ”€â”€ README.md                   # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª¬æ˜
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ SPECIFICATION.md        # ç°¡æ˜“ä»•æ§˜æ›¸
â”‚   â”œâ”€â”€ HANDOVER.md             # å¼•ç¶™ãæ›¸
â”‚   â””â”€â”€ MIGRATION_PLAN.md       # ç§»è¡Œè¨ˆç”»
â””â”€â”€ streamlit_app/
    â”œâ”€â”€ app.py                  # Streamlitãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒª
    â”œâ”€â”€ requirements.txt        # Pythonä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
    â”œâ”€â”€ .streamlit/
    â”‚   â””â”€â”€ config.toml         # Streamlitè¨­å®š
    â”œâ”€â”€ pages/
    â”‚   â”œâ”€â”€ 1_é¸æ‰‹ä¸€è¦§.py        # é¸æ‰‹ä¸€è¦§ãƒšãƒ¼ã‚¸
    â”‚   â”œâ”€â”€ 2_é¸æ‰‹è©³ç´°.py        # é¸æ‰‹è©³ç´°ãƒšãƒ¼ã‚¸
    â”‚   â””â”€â”€ 3_è¨˜éŒ²å…¥åŠ›.py        # è¨˜éŒ²å…¥åŠ›ãƒšãƒ¼ã‚¸
    â””â”€â”€ utils/
        â”œâ”€â”€ __init__.py
        â”œâ”€â”€ sheets.py           # Spreadsheetæ¥ç¶šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
        â””â”€â”€ style.py            # ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š
```

---

## 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### 3.1 ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæƒ…å ±

| é …ç›® | å€¤ |
|------|-----|
| ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆID | `1Obbd41yFX_KPmag4foqtijxRpUgTZCzBq0vpqff-f3k` |
| ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ | Asia/Tokyo |

### 3.2 Players ã‚·ãƒ¼ãƒˆï¼ˆé¸æ‰‹ãƒã‚¹ã‚¿ï¼‰

é¸æ‰‹ã®åŸºæœ¬æƒ…å ±ã¨ç›®æ¨™ã‚¿ã‚¤ãƒ ã‚’ç®¡ç†

| # | ã‚«ãƒ©ãƒ å | æ—¥æœ¬èªå | ãƒ‡ãƒ¼ã‚¿å‹ | å¿…é ˆ | èª¬æ˜ |
|---|---------|----------|---------|------|------|
| 1 | id | é¸æ‰‹ID | UUID | â—‹ | ä¸€æ„è­˜åˆ¥å­ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰ |
| 2 | registration_number | ç™»éŒ²ç•ªå· | String | â—‹ | ãƒãƒ¼ãƒ å†…ç™»éŒ²ç•ªå·ï¼ˆé‡è¤‡ä¸å¯ï¼‰ |
| 3 | name | æ°å | String | â—‹ | é¸æ‰‹æ°å |
| 4 | affiliation | æ‰€å± | String | | æ‰€å±ãƒãƒ¼ãƒ /å­¦æ ¡å |
| 5 | category | å­¦å¹´/ã‚«ãƒ†ã‚´ãƒª | String | | ä¸­å­¦ç”Ÿ/é«˜æ ¡ç”Ÿ/å¤§å­¦ç”Ÿ/ä¸€èˆ¬/30ä»£ç­‰ |
| 6 | target_1500m | 1500mç›®æ¨™ | Time String | | ç›®æ¨™ã‚¿ã‚¤ãƒ ï¼ˆä¾‹: "4:10"ï¼‰ |
| 7 | target_3000m | 3000mç›®æ¨™ | Time String | | ç›®æ¨™ã‚¿ã‚¤ãƒ ï¼ˆä¾‹: "9:00"ï¼‰ |
| 8 | target_5000m | 5000mç›®æ¨™ | Time String | | ç›®æ¨™ã‚¿ã‚¤ãƒ ï¼ˆä¾‹: "15:30"ï¼‰ |
| 9 | target_10000m | 10000mç›®æ¨™ | Time String | | ç›®æ¨™ã‚¿ã‚¤ãƒ ï¼ˆä¾‹: "32:00"ï¼‰ |
| 10 | target_half | ãƒãƒ¼ãƒ•ç›®æ¨™ | Time String | | ç›®æ¨™ã‚¿ã‚¤ãƒ ï¼ˆä¾‹: "1:10:00"ï¼‰ |
| 11 | target_full | ãƒ•ãƒ«ç›®æ¨™ | Time String | | ç›®æ¨™ã‚¿ã‚¤ãƒ ï¼ˆä¾‹: "2:30:00"ï¼‰ |
| 12 | comment | ä¸€è¨€/å‚™è€ƒ | Text | | é¸æ‰‹ã®ã‚³ãƒ¡ãƒ³ãƒˆãƒ»å‚™è€ƒ |
| 13 | is_deleted | å‰Šé™¤ãƒ•ãƒ©ã‚° | Boolean | | true = è«–ç†å‰Šé™¤ |
| 14 | created_at | ä½œæˆæ—¥æ™‚ | DateTime | â—‹ | ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆæ—¥æ™‚ |
| 15 | updated_at | æ›´æ–°æ—¥æ™‚ | DateTime | â—‹ | æœ€çµ‚æ›´æ–°æ—¥æ™‚ |

### 3.3 Records ã‚·ãƒ¼ãƒˆï¼ˆå€‹äººè¨˜éŒ²ï¼‰

é¸æ‰‹ã”ã¨ã®å¤§ä¼šè¨˜éŒ²ã‚’ç®¡ç†

| # | ã‚«ãƒ©ãƒ å | æ—¥æœ¬èªå | ãƒ‡ãƒ¼ã‚¿å‹ | å¿…é ˆ | èª¬æ˜ |
|---|---------|----------|---------|------|------|
| 1 | record_id | è¨˜éŒ²ID | UUID | â—‹ | ä¸€æ„è­˜åˆ¥å­ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰ |
| 2 | player_id | é¸æ‰‹ID | UUID | â—‹ | Playersã‚·ãƒ¼ãƒˆã¸ã®å¤–éƒ¨ã‚­ãƒ¼ |
| 3 | race_name | å¤§ä¼šå | String | â—‹ | å¤§ä¼šãƒ»è¨˜éŒ²ä¼šã®åç§° |
| 4 | date | é–‹å‚¬æ—¥ | Date | â—‹ | å¤§ä¼šé–‹å‚¬æ—¥ |
| 5 | section | åŒºé–“/ç¨®ç›® | String | â—‹ | 1500m/3000m/5000m/10000m/ãƒãƒ¼ãƒ•/ãƒ•ãƒ«/1åŒºã€œ6åŒºç­‰ |
| 6 | time | è¨˜éŒ² | Time String | â—‹ | ã‚¿ã‚¤ãƒ ï¼ˆä¾‹: "15:30" or "1:05:30"ï¼‰ |
| 7 | memo | å‚™è€ƒ | Text | | ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ãƒ»æ„Ÿæƒ³ç­‰ |
| 8 | created_at | ä½œæˆæ—¥æ™‚ | DateTime | â—‹ | ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆæ—¥æ™‚ |
| 9 | updated_at | æ›´æ–°æ—¥æ™‚ | DateTime | â—‹ | æœ€çµ‚æ›´æ–°æ—¥æ™‚ |

### 3.4 TeamRecords ã‚·ãƒ¼ãƒˆï¼ˆãƒãƒ¼ãƒ è¨˜éŒ²ï¼‰

ãƒãƒ¼ãƒ å…¨ä½“ã®é§…ä¼è¨˜éŒ²ã‚’ç®¡ç†

| # | ã‚«ãƒ©ãƒ å | æ—¥æœ¬èªå | ãƒ‡ãƒ¼ã‚¿å‹ | å¿…é ˆ | èª¬æ˜ |
|---|---------|----------|---------|------|------|
| 1 | team_record_id | ãƒãƒ¼ãƒ è¨˜éŒ²ID | UUID | â—‹ | ä¸€æ„è­˜åˆ¥å­ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰ |
| 2 | race_name | å¤§ä¼šå | String | â—‹ | é§…ä¼å¤§ä¼šå |
| 3 | date | é–‹å‚¬æ—¥ | Date | â—‹ | å¤§ä¼šé–‹å‚¬æ—¥ |
| 4 | total_time | ç·åˆè¨˜éŒ² | Time String | | ç·åˆã‚¿ã‚¤ãƒ  |
| 5 | rank | é †ä½ | Number | | å¤§ä¼šé †ä½ |
| 6 | memo | å‚™è€ƒ | Text | | å‚™è€ƒ |
| 7 | created_at | ä½œæˆæ—¥æ™‚ | DateTime | â—‹ | ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆæ—¥æ™‚ |
| 8 | updated_at | æ›´æ–°æ—¥æ™‚ | DateTime | â—‹ | æœ€çµ‚æ›´æ–°æ—¥æ™‚ |

### 3.5 Simulations ã‚·ãƒ¼ãƒˆï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰

åŒºé–“ã‚ªãƒ¼ãƒ€ãƒ¼ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¡ˆã‚’ä¿å­˜

| # | ã‚«ãƒ©ãƒ å | æ—¥æœ¬èªå | ãƒ‡ãƒ¼ã‚¿å‹ | å¿…é ˆ | èª¬æ˜ |
|---|---------|----------|---------|------|------|
| 1 | sim_id | ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ID | UUID | â—‹ | ä¸€æ„è­˜åˆ¥å­ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰ |
| 2 | title | æ¡ˆã®åç§° | String | â—‹ | ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åï¼ˆä¾‹: "Aãƒãƒ¼ãƒ æ¡ˆ"ï¼‰ |
| 3 | created_at | ä½œæˆæ—¥æ™‚ | DateTime | â—‹ | ä½œæˆæ—¥æ™‚ |
| 4 | order_json | ã‚ªãƒ¼ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿ | JSON String | â—‹ | åŒºé–“é…ç½®ãƒ‡ãƒ¼ã‚¿ï¼ˆJSONå½¢å¼ï¼‰ |
| 5 | updated_at | æ›´æ–°æ—¥æ™‚ | DateTime | â—‹ | æœ€çµ‚æ›´æ–°æ—¥æ™‚ |

#### order_json ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

```json
[
  {
    "section": 1,
    "player_id": "uuid-xxx",
    "player_name": "å±±ç”°å¤ªéƒ",
    "distance": "10"
  },
  {
    "section": 2,
    "player_id": "uuid-yyy",
    "player_name": "ä½è—¤èŠ±å­",
    "distance": "5"
  }
]
```

---

## 4. GASãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ä»•æ§˜

### 4.1 å®šæ•°å®šç¾©

```javascript
const SPREADSHEET_ID = '1Obbd41yFX_KPmag4foqtijxRpUgTZCzBq0vpqff-f3k';

const SHEET_DEFINITIONS = {
  Players: { name: 'Players', headers: [...], headerLabels: [...] },
  Records: { name: 'Records', headers: [...], headerLabels: [...] },
  TeamRecords: { name: 'TeamRecords', headers: [...], headerLabels: [...] },
  Simulations: { name: 'Simulations', headers: [...], headerLabels: [...] }
};
```

### 4.2 é–¢æ•°ä¸€è¦§

#### 4.2.1 ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—é–¢æ•°

| é–¢æ•°å | èª¬æ˜ | å¼•æ•° | æˆ»ã‚Šå€¤ |
|--------|------|------|--------|
| `setupDatabase()` | å…¨ã‚·ãƒ¼ãƒˆã®åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— | ãªã— | çµæœã‚µãƒãƒªãƒ¼æ–‡å­—åˆ— |
| `setupSheet(ss, definition)` | å€‹åˆ¥ã‚·ãƒ¼ãƒˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— | Spreadsheet, ã‚·ãƒ¼ãƒˆå®šç¾© | çµæœã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ |
| `setupSingleSheet(sheetKey)` | å˜ä¸€ã‚·ãƒ¼ãƒˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— | ã‚·ãƒ¼ãƒˆã‚­ãƒ¼å | çµæœã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ |
| `checkDatabaseStatus()` | DBçŠ¶æ…‹ç¢ºèª | ãªã— | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é…åˆ— |
| `clearAllData()` | å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢ï¼ˆç¢ºèªã‚ã‚Šï¼‰ | ãªã— | ãªã— |

#### 4.2.2 ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°

| é–¢æ•°å | èª¬æ˜ | å¼•æ•° | æˆ»ã‚Šå€¤ |
|--------|------|------|--------|
| `generateUUID()` | UUID v4ç”Ÿæˆ | ãªã— | UUIDæ–‡å­—åˆ— |
| `getCurrentDateTime()` | ç¾åœ¨æ—¥æ™‚å–å¾— | ãªã— | Date |
| `getSpreadsheet()` | ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆå–å¾— | ãªã— | Spreadsheet |
| `timeToSeconds(timeStr)` | æ™‚é–“â†’ç§’å¤‰æ› | "MM:SS" or "HH:MM:SS" | ç§’æ•° or null |
| `secondsToTime(seconds)` | ç§’â†’æ™‚é–“å¤‰æ› | ç§’æ•° | æ™‚é–“æ–‡å­—åˆ— |
| `formatDate(date)` | æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ | Date or String | "YYYY/MM/DD" |

#### 4.2.3 ãƒ‡ãƒ¼ã‚¿å–å¾—API

| é–¢æ•°å | èª¬æ˜ | å¼•æ•° | æˆ»ã‚Šå€¤ |
|--------|------|------|--------|
| `getPlayers(options)` | é¸æ‰‹ä¸€è¦§å–å¾— | {sortBy, order} | {success, data: Player[]} |
| `getPlayerDetail(playerId)` | é¸æ‰‹è©³ç´°å–å¾— | é¸æ‰‹ID | {success, data: Player} |
| `getPlayerRecords(playerId, options)` | é¸æ‰‹è¨˜éŒ²å–å¾— | é¸æ‰‹ID, {sortBy, order} | {success, data: Record[]} |
| `getRecordHistory(playerId, section)` | ã‚°ãƒ©ãƒ•ç”¨æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ | é¸æ‰‹ID, ç¨®ç›® | {success, data: ChartData} |
| `getTeamRecords(options)` | ãƒãƒ¼ãƒ è¨˜éŒ²å–å¾— | {sortBy, order} | {success, data: TeamRecord[]} |
| `loadSimulations()` | ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä¸€è¦§ | ãªã— | {success, data: Simulation[]} |

#### 4.2.4 ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³API

| é–¢æ•°å | èª¬æ˜ | å¼•æ•° | æˆ»ã‚Šå€¤ |
|--------|------|------|--------|
| `addPersonalRecord(data)` | å€‹äººè¨˜éŒ²è¿½åŠ  | {player_id, race_name, date, section, time, memo} | {success, data: {record_id}} |
| `updateProfile(data)` | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–° | {player_id, target_*, comment} | {success} |
| `calculateTargetDiff(bestTime, targetTime)` | ç›®æ¨™é”æˆåº¦è¨ˆç®— | ãƒ™ã‚¹ãƒˆ, ç›®æ¨™ | {success, data: å·®åˆ†æƒ…å ±} |

#### 4.2.5 ç®¡ç†è€…API

| é–¢æ•°å | èª¬æ˜ | å¼•æ•° | æˆ»ã‚Šå€¤ |
|--------|------|------|--------|
| `addPlayer(data)` | é¸æ‰‹è¿½åŠ  | é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ | {success, data: {id}} |
| `updatePlayer(data)` | é¸æ‰‹æ›´æ–° | é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ï¼ˆidå¿…é ˆï¼‰ | {success} |
| `deletePlayer(playerId)` | é¸æ‰‹è«–ç†å‰Šé™¤ | é¸æ‰‹ID | {success} |
| `importPlayersFromCSV(csvContent)` | CSVä¸€æ‹¬ç™»éŒ² | CSVæ–‡å­—åˆ— | {success, data: {imported, skipped, errors}} |
| `addTeamRecord(data)` | ãƒãƒ¼ãƒ è¨˜éŒ²è¿½åŠ  | ãƒãƒ¼ãƒ è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿ | {success, data: {team_record_id}} |
| `saveSimulation(data)` | ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä¿å­˜ | {title, order_json} | {success, data: {sim_id}} |

#### 4.2.6 Webã‚¢ãƒ—ãƒªã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ

| é–¢æ•°å | èª¬æ˜ | å¼•æ•° | æˆ»ã‚Šå€¤ |
|--------|------|------|--------|
| `doGet(e)` | GETãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç† | ã‚¤ãƒ™ãƒ³ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ | HtmlOutput |
| `include(filename)` | HTMLã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ | ãƒ•ã‚¡ã‚¤ãƒ«å | HTMLæ–‡å­—åˆ— |

### 4.3 API ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼

#### æˆåŠŸæ™‚
```javascript
{
  success: true,
  data: { /* çµæœãƒ‡ãƒ¼ã‚¿ */ }
}
```

#### å¤±æ•—æ™‚
```javascript
{
  success: false,
  error: "ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸",
  data: null  // ã¾ãŸã¯ []
}
```

### 4.4 ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | ãƒ«ãƒ¼ãƒ« |
|-----------|--------|
| name | å¿…é ˆã€ç©ºæ–‡å­—ä¸å¯ |
| registration_number | å¿…é ˆã€é‡è¤‡ä¸å¯ |
| player_id | å¿…é ˆã€Playersã«å­˜åœ¨ |
| race_name | å¿…é ˆï¼ˆè¨˜éŒ²è¿½åŠ æ™‚ï¼‰ |
| section | å¿…é ˆï¼ˆè¨˜éŒ²è¿½åŠ æ™‚ï¼‰ |
| time | å¿…é ˆï¼ˆè¨˜éŒ²è¿½åŠ æ™‚ï¼‰ã€"MM:SS" or "HH:MM:SS"å½¢å¼ |

---

## 5. Webãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ä»•æ§˜

### 5.1 ãƒšãƒ¼ã‚¸æ§‹æˆ

| ãƒšãƒ¼ã‚¸ | ãƒ•ã‚¡ã‚¤ãƒ« | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | èª¬æ˜ |
|--------|---------|-----------|------|
| ãƒ¡ã‚¤ãƒ³ï¼ˆé¸æ‰‹ä¸€è¦§ï¼‰ | index.html | mode=user/admin | é¸æ‰‹ä¸€è¦§ãƒ»é¸æ‰‹è©³ç´°è¡¨ç¤º |
| é¸æ‰‹è©³ç´° | index.html | pid=é¸æ‰‹ID, mode | å€‹äººãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ»è¨˜éŒ² |
| ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | simulation.html | mode=admin | åŒºé–“ã‚ªãƒ¼ãƒ€ãƒ¼ç·¨æˆ |
| CSVç™»éŒ² | csv.html | mode=admin | CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ |

### 5.2 URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å€¤ | èª¬æ˜ |
|-----------|-----|------|
| page | main/simulation/csv | è¡¨ç¤ºãƒšãƒ¼ã‚¸æŒ‡å®š |
| mode | user/admin | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ¼ãƒ‰ |
| pid | UUID | é¸æ‰‹IDï¼ˆæ³¨: `id`ã¯GASäºˆç´„èªã®ãŸã‚`pid`ã‚’ä½¿ç”¨ï¼‰ |

### 5.3 ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ï¼ˆJavaScriptï¼‰

```javascript
const APP_MODE = 'user' | 'admin';  // ãƒ¢ãƒ¼ãƒ‰
const INITIAL_PLAYER_ID = '';       // åˆæœŸè¡¨ç¤ºé¸æ‰‹ID
const BASE_URL = 'https://...';     // Webã‚¢ãƒ—ãƒªãƒ™ãƒ¼ã‚¹URL
let currentPlayerId = null;         // ç¾åœ¨é¸æŠä¸­ã®é¸æ‰‹ID
let playersData = [];               // é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥
let recordChart = null;             // Chart.jsã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
```

### 5.4 UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### 5.4.1 é¸æ‰‹ã‚«ãƒ¼ãƒ‰
```html
<a class="player-card" href="?pid={id}&mode={mode}">
  <div class="player-card-number">{registration_number}</div>
  <div class="player-card-name">{name}</div>
  <div class="player-card-info">
    <span>{affiliation}</span>
    <span>{category}</span>
  </div>
</a>
```

#### 5.4.2 ç›®æ¨™ã‚¿ã‚¤ãƒ ã‚«ãƒ¼ãƒ‰
```html
<div class="target-card">
  <div class="target-card-label">{ç¨®ç›®}</div>
  <div class="target-card-value">{ç›®æ¨™ã‚¿ã‚¤ãƒ }</div>
  <div class="target-card-label">PB: {è‡ªå·±ãƒ™ã‚¹ãƒˆ}</div>
  <div class="target-card-diff achieved|pending">{é”æˆåº¦}</div>
</div>
```

#### 5.4.3 è¨˜éŒ²ã‚¢ã‚¤ãƒ†ãƒ 
```html
<div class="record-item">
  <div class="record-item-header">
    <span class="record-item-date">{æ—¥ä»˜}</span>
    <span class="record-item-time">{ã‚¿ã‚¤ãƒ }</span>
  </div>
  <div class="record-item-race">{å¤§ä¼šå}</div>
  <span class="record-item-section">{ç¨®ç›®}</span>
</div>
```

### 5.5 ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°

| ãƒ¢ãƒ¼ãƒ€ãƒ«ID | ç”¨é€” | ãƒˆãƒªã‚¬ãƒ¼ |
|-----------|------|---------|
| playerModal | é¸æ‰‹è¿½åŠ /ç·¨é›† | ã€Œé¸æ‰‹è¿½åŠ ã€ãƒœã‚¿ãƒ³ / ã€Œç·¨é›†ã€ãƒœã‚¿ãƒ³ |
| recordModal | è¨˜éŒ²è¿½åŠ  | ã€Œè¨˜éŒ²è¿½åŠ ã€ãƒœã‚¿ãƒ³ |
| profileModal | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ç”¨ï¼‰ | ã€Œç›®æ¨™ç·¨é›†ã€ãƒœã‚¿ãƒ³ |
| saveModal | ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä¿å­˜ | ã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ |

### 5.6 CSS ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

```css
:root {
  --primary-color: #4a86e8;
  --primary-dark: #3d71c7;
  --secondary-color: #6c757d;
  --success-color: #28a745;
  --danger-color: #dc3545;
  --warning-color: #ffc107;
  --light-color: #f8f9fa;
  --dark-color: #343a40;
  --border-color: #dee2e6;
  --text-color: #333;
  --text-muted: #6c757d;
  --bg-color: #f5f7fa;
  --card-bg: #ffffff;
  --shadow: 0 2px 4px rgba(0,0,0,0.1);
  --shadow-lg: 0 4px 12px rgba(0,0,0,0.15);
  --radius: 8px;
  --radius-sm: 4px;
  --transition: all 0.2s ease;
}
```

### 5.7 ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆ

| ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆ | å¯¾è±¡ãƒ‡ãƒã‚¤ã‚¹ | ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå¤‰æ›´ |
|-----------------|-------------|---------------|
| 992px | ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸1ã‚«ãƒ©ãƒ åŒ– |
| 768px | ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç¸¦ | ãƒ•ã‚©ãƒ¼ãƒ ã‚°ãƒªãƒƒãƒ‰1ã‚«ãƒ©ãƒ åŒ– |
| 480px | ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ | ã‚«ãƒ¼ãƒ‰ã‚°ãƒªãƒƒãƒ‰1ã‚«ãƒ©ãƒ åŒ– |

---

## 6. Streamlitã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä»•æ§˜

### 6.1 ã‚¢ãƒ—ãƒªæ§‹æˆ

| ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ |
|---------|------|
| app.py | ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼‰ |
| pages/1_é¸æ‰‹ä¸€è¦§.py | é¸æ‰‹ä¸€è¦§ãƒšãƒ¼ã‚¸ |
| pages/2_é¸æ‰‹è©³ç´°.py | é¸æ‰‹è©³ç´°ãƒšãƒ¼ã‚¸ |
| pages/3_è¨˜éŒ²å…¥åŠ›.py | è¨˜éŒ²å…¥åŠ›ãƒšãƒ¼ã‚¸ |

### 6.2 å…±é€šè¨­å®š

```python
st.set_page_config(
    page_title="é§…ä¼ãƒãƒ¼ãƒ ç®¡ç†",
    page_icon="ğŸƒ",
    layout="wide",
    initial_sidebar_state="expanded",
)
```

### 6.3 èªè¨¼è¨­å®š

#### ç’°å¢ƒå¤‰æ•°å„ªå…ˆï¼ˆHugging Face Spaces / Cloud Runï¼‰
```python
gcp_key = os.environ.get("GCP_KEY")
if gcp_key:
    credentials_info = json.loads(gcp_key)
```

#### Streamlit Secretsï¼ˆStreamlit Cloud / ãƒ­ãƒ¼ã‚«ãƒ«ï¼‰
```python
credentials_info = dict(st.secrets["gcp_service_account"])
```

### 6.4 ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®š

| ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ | TTL | ç”¨é€” |
|-----------|-----|------|
| `@st.cache_resource` | æ°¸ç¶š | gspreadã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ |
| `@st.cache_data(ttl=60)` | 60ç§’ | é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ã€è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿ |

### 6.5 utils/sheets.py é–¢æ•°

| é–¢æ•°å | èª¬æ˜ | æˆ»ã‚Šå€¤ |
|--------|------|--------|
| `get_credentials_info()` | èªè¨¼æƒ…å ±å–å¾— | dict |
| `get_client()` | gspreadã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå–å¾— | gspread.Client |
| `get_spreadsheet()` | ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆå–å¾— | gspread.Spreadsheet |
| `get_players()` | é¸æ‰‹ä¸€è¦§å–å¾— | pd.DataFrame |
| `get_player_by_id(player_id)` | é¸æ‰‹è©³ç´°å–å¾— | dict or None |
| `get_records(player_id)` | è¨˜éŒ²å–å¾— | pd.DataFrame |
| `get_team_records()` | ãƒãƒ¼ãƒ è¨˜éŒ²å–å¾— | pd.DataFrame |
| `add_record(...)` | è¨˜éŒ²è¿½åŠ  | bool |
| `calculate_best_records(df)` | ãƒ™ã‚¹ãƒˆè¨ˆç®— | dict |
| `time_to_seconds(time_str)` | æ™‚é–“â†’ç§’å¤‰æ› | float or None |
| `seconds_to_time(seconds)` | ç§’â†’æ™‚é–“å¤‰æ› | str |

### 6.6 ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

```
streamlit>=1.28.0
gspread>=5.12.0
google-auth>=2.23.0
pandas>=2.0.0
plotly>=5.18.0
```

---

## 7. APIä»•æ§˜

### 7.1 GAS Web App API

#### ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
```
https://script.google.com/macros/s/{DEPLOYMENT_ID}/exec
```

#### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å€¤ | èª¬æ˜ |
|-----------|-----|------|
| page | main/simulation/csv | ãƒšãƒ¼ã‚¸æŒ‡å®š |
| mode | user/admin | ãƒ¢ãƒ¼ãƒ‰ |
| pid | UUID | é¸æ‰‹ID |

### 7.2 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰APIå‘¼ã³å‡ºã—

```javascript
// é¸æ‰‹ä¸€è¦§å–å¾—
google.script.run
  .withSuccessHandler(function(result) {
    if (result.success) {
      console.log(result.data);
    }
  })
  .withFailureHandler(function(error) {
    console.error(error.message);
  })
  .getPlayers();
```

### 7.3 Google Sheets API ã‚¹ã‚³ãƒ¼ãƒ—

```json
{
  "oauthScopes": [
    "https://www.googleapis.com/auth/spreadsheets",
    "https://www.googleapis.com/auth/script.container.ui"
  ]
}
```

---

## 8. ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆä»•æ§˜

### 8.1 GAS ãƒ‡ãƒ—ãƒ­ã‚¤

#### appsscript.json è¨­å®š
```json
{
  "timeZone": "Asia/Tokyo",
  "dependencies": {},
  "exceptionLogging": "STACKDRIVER",
  "runtimeVersion": "V8",
  "webapp": {
    "executeAs": "USER_DEPLOYING",
    "access": "ANYONE_ANONYMOUS"
  }
}
```

#### clasp è¨­å®šï¼ˆ.clasp.jsonï¼‰
```json
{
  "scriptId": "ã‚¹ã‚¯ãƒªãƒ—ãƒˆID",
  "rootDir": "."
}
```

### 8.2 Cloud Run ãƒ‡ãƒ—ãƒ­ã‚¤

#### Dockerfile
```dockerfile
FROM python:3.9-slim
WORKDIR /app
COPY streamlit_app/requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
COPY streamlit_app/ .
EXPOSE 8080
ENV STREAMLIT_SERVER_ADDRESS=0.0.0.0
ENV STREAMLIT_SERVER_HEADLESS=true
CMD streamlit run app.py --server.port=${PORT:-8080} --server.address=0.0.0.0
```

#### ç’°å¢ƒå¤‰æ•°
| å¤‰æ•°å | èª¬æ˜ | å¿…é ˆ |
|--------|------|------|
| GCP_KEY | ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆJSON | â—‹ |
| PORT | ãƒãƒ¼ãƒˆç•ªå·ï¼ˆCloud Runè‡ªå‹•è¨­å®šï¼‰ | - |

### 8.3 Hugging Face Spaces ãƒ‡ãƒ—ãƒ­ã‚¤

#### ç’°å¢ƒå¤‰æ•°
```
GCP_KEY={"type":"service_account",...}
```

---

## 9. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä»•æ§˜

### 9.1 èªè¨¼ãƒ»èªå¯

| é …ç›® | ä»•æ§˜ |
|------|------|
| GAS Web App | ANYONE_ANONYMOUSï¼ˆURLã‚’çŸ¥ã£ã¦ã„ã‚‹äººãŒã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼‰ |
| Streamlit | ç’°å¢ƒå¤‰æ•°ã¾ãŸã¯Secretsã«ã‚ˆã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆèªè¨¼ |
| ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ | ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ç·¨é›†æ¨©é™ã‚’ä»˜ä¸ |

### 9.2 ãƒ‡ãƒ¼ã‚¿ä¿è­·

| é …ç›® | å¯¾ç­– |
|------|------|
| è«–ç†å‰Šé™¤ | ç‰©ç†å‰Šé™¤ã§ã¯ãªãis_deletedãƒ•ãƒ©ã‚°ã§ç®¡ç† |
| å…¥åŠ›æ¤œè¨¼ | å¿…é ˆé …ç›®ãƒã‚§ãƒƒã‚¯ã€é‡è¤‡ãƒã‚§ãƒƒã‚¯ |
| XSSå¯¾ç­– | ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã«ã‚ˆã‚‹ã‚¨ã‚¹ã‚±ãƒ¼ãƒ— |

### 9.3 OAuth ã‚¹ã‚³ãƒ¼ãƒ—

æœ€å°é™ã®ã‚¹ã‚³ãƒ¼ãƒ—ã®ã¿ã‚’ä½¿ç”¨:
- `spreadsheets`: ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®èª­ã¿æ›¸ã
- `script.container.ui`: GAS UIã‚¢ã‚¯ã‚»ã‚¹

---

## ä»˜éŒ²

### A. ã‚¿ã‚¤ãƒ ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä»•æ§˜

| å½¢å¼ | ä¾‹ | ç”¨é€” |
|------|-----|------|
| MM:SS | 15:30 | 1500m, 3000m, 5000m |
| HH:MM:SS | 1:05:30 | 10000m, ãƒãƒ¼ãƒ•, ãƒ•ãƒ« |
| ç§’æ•° | 930 | å†…éƒ¨è¨ˆç®—ç”¨ |

### B. ç¨®ç›®ä¸€è¦§

| ç¨®ç›®å | æ¨™æº–è·é›¢ |
|--------|---------|
| 1500m | 1.5km |
| 3000m | 3km |
| 5000m | 5km |
| 10000m | 10km |
| ãƒãƒ¼ãƒ•ï¼ˆãƒãƒ¼ãƒ•ãƒãƒ©ã‚½ãƒ³ï¼‰ | 21.0975km |
| ãƒ•ãƒ«ï¼ˆãƒ•ãƒ«ãƒãƒ©ã‚½ãƒ³ï¼‰ | 42.195km |
| 1åŒºã€œ10åŒº | å¤§ä¼šã«ã‚ˆã‚Šç•°ãªã‚‹ |

### C. ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰

| ã‚³ãƒ¼ãƒ‰ | èª¬æ˜ |
|--------|------|
| SHEET_NOT_FOUND | æŒ‡å®šã‚·ãƒ¼ãƒˆãŒå­˜åœ¨ã—ãªã„ |
| PLAYER_NOT_FOUND | é¸æ‰‹ãŒè¦‹ã¤ã‹ã‚‰ãªã„ |
| DUPLICATE_REGISTRATION | ç™»éŒ²ç•ªå·ãŒé‡è¤‡ |
| INVALID_TIME_FORMAT | ã‚¿ã‚¤ãƒ å½¢å¼ãŒä¸æ­£ |
| REQUIRED_FIELD_MISSING | å¿…é ˆé …ç›®ãŒæœªå…¥åŠ› |

---

*ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆæ—¥: 2024å¹´*
*ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 1.0*
