# é§…ä¼ãƒãƒ¼ãƒ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  Streamlitç‰ˆ ä»•æ§˜æ›¸

## 1. æ–‡æ›¸æƒ…å ±

| é …ç›® | å†…å®¹ |
|------|------|
| æ–‡æ›¸å | é§…ä¼ãƒãƒ¼ãƒ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  Streamlitç‰ˆ ä»•æ§˜æ›¸ |
| ä½œæˆæ—¥ | 2025-12-07 |
| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | v0.6 |
| å…ƒã‚·ã‚¹ãƒ†ãƒ  | GASç‰ˆ Ver2.0ï¼ˆSPECIFICATION.mdå‚ç…§ï¼‰ |

---

## 2. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### 2.1 ç§»è¡Œç›®çš„

| èª²é¡Œ | è§£æ±ºç­– |
|------|--------|
| GASã®å‹•ä½œãŒé…ã„ï¼ˆãƒšãƒ¼ã‚¸æ›´æ–°ã«5ç§’ï¼‰ | Streamlitã§é«˜é€ŸåŒ–ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æ´»ç”¨ï¼‰ |
| GASã®ä¿å®ˆæ€§ãŒä½ã„ | Pythonã«ã‚ˆã‚‹å¯èª­æ€§å‘ä¸Š |

### 2.2 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| é …ç›® | æŠ€è¡“ |
|------|------|
| ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | Streamlit 1.28.0+ |
| è¨€èª | Python 3.9+ |
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | Google Spreadsheetsï¼ˆæ—¢å­˜ç¶™ç¶šï¼‰ |
| èªè¨¼ | Google Service Account |
| ã‚°ãƒ©ãƒ• | Plotly 5.18.0+ |
| ãƒ‡ãƒ¼ã‚¿å‡¦ç† | pandas 2.0.0+ |
| Google API | gspread 5.12.0+, google-auth 2.23.0+ |
| ã‚³ãƒ³ãƒ†ãƒŠ | Docker |

### 2.3 å®Ÿè£…ç¯„å›²

| æ©Ÿèƒ½ | GASç‰ˆ | Streamlitç‰ˆ | çŠ¶æ…‹ |
|------|-------|-------------|------|
| é¸æ‰‹ä¸€è¦§ãƒ»æ¤œç´¢ | â—‹ | â—‹ | å®Ÿè£…æ¸ˆã¿ |
| é¸æ‰‹è©³ç´°è¡¨ç¤º | â—‹ | â—‹ | å®Ÿè£…æ¸ˆã¿ |
| ç›®æ¨™ã‚¿ã‚¤ãƒ è¡¨ç¤º | â—‹ | â—‹ | å®Ÿè£…æ¸ˆã¿ |
| è‡ªå·±ãƒ™ã‚¹ãƒˆè¨ˆç®— | â—‹ | â—‹ | å®Ÿè£…æ¸ˆã¿ |
| è¨˜éŒ²æ¨ç§»ã‚°ãƒ©ãƒ• | â—‹ | â—‹ | å®Ÿè£…æ¸ˆã¿ |
| è¨˜éŒ²å…¥åŠ› | â—‹ | â—‹ | å®Ÿè£…æ¸ˆã¿ |
| é¸æ‰‹è¿½åŠ ãƒ»ç·¨é›† | â—‹ | - | æœªå®Ÿè£… |
| é¸æ‰‹å‰Šé™¤ | â—‹ | - | æœªå®Ÿè£… |
| ãƒãƒ¼ãƒ è¨˜éŒ² | â—‹ | - | æœªå®Ÿè£… |
| åŒºé–“ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | â—‹ | - | æœªå®Ÿè£… |
| CSVä¸€æ‹¬ç™»éŒ² | â—‹ | - | æœªå®Ÿè£… |

---

## 3. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
GAS_Ekiden-Report/
â”œâ”€â”€ Dockerfile                    # ã‚³ãƒ³ãƒ†ãƒŠè¨­å®šï¼ˆCloud Runå¯¾å¿œï¼‰
â”œâ”€â”€ README.md                     # Hugging Face Spacesç”¨è¨­å®š
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ SPECIFICATION.md          # å…ƒGASç‰ˆä»•æ§˜æ›¸
â”‚   â”œâ”€â”€ STREAMLIT_SPECIFICATION.md # ã“ã®ä»•æ§˜æ›¸
â”‚   â”œâ”€â”€ MIGRATION_PLAN.md         # ç§»è¡Œè¨ˆç”»
â”‚   â””â”€â”€ HANDOVER.md               # å¼•ç¶™ãè³‡æ–™
â””â”€â”€ streamlit_app/
    â”œâ”€â”€ app.py                    # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªï¼ˆãƒ›ãƒ¼ãƒ ç”»é¢ï¼‰
    â”œâ”€â”€ requirements.txt          # Pythonä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
    â”œâ”€â”€ .streamlit/
    â”‚   â”œâ”€â”€ config.toml           # Streamlitè¨­å®š
    â”‚   â””â”€â”€ secrets.toml          # èªè¨¼æƒ…å ±ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç”¨ã€Gitéç®¡ç†ï¼‰
    â”œâ”€â”€ pages/
    â”‚   â”œâ”€â”€ 1_é¸æ‰‹ä¸€è¦§.py          # é¸æ‰‹ä¸€è¦§ãƒšãƒ¼ã‚¸
    â”‚   â”œâ”€â”€ 2_é¸æ‰‹è©³ç´°.py          # é¸æ‰‹è©³ç´°ãƒšãƒ¼ã‚¸
    â”‚   â””â”€â”€ 3_è¨˜éŒ²å…¥åŠ›.py          # è¨˜éŒ²å…¥åŠ›ãƒšãƒ¼ã‚¸
    â””â”€â”€ utils/
        â”œâ”€â”€ __init__.py
        â”œâ”€â”€ sheets.py             # Google Spreadsheetsæ¥ç¶š
        â””â”€â”€ style.py              # å…±é€šCSS/ã‚¹ã‚¿ã‚¤ãƒ«
```

---

## 4. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### 4.1 ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæƒ…å ±

| é …ç›® | å€¤ |
|------|-----|
| ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆID | `1Obbd41yFX_KPmag4foqtijxRpUgTZCzBq0vpqff-f3k` |
| å¿…è¦ãªæ¨©é™ã‚¹ã‚³ãƒ¼ãƒ— | `https://www.googleapis.com/auth/spreadsheets` |

### 4.2 Playersã‚·ãƒ¼ãƒˆï¼ˆé¸æ‰‹ãƒã‚¹ã‚¿ï¼‰

| ã‚«ãƒ©ãƒ å | å‹ | èª¬æ˜ | å¿…é ˆ |
|----------|-----|------|------|
| id | string | é¸æ‰‹IDï¼ˆUUIDï¼‰ | â—‹ |
| name | string | é¸æ‰‹å | â—‹ |
| registration_number | string | ç™»éŒ²ç•ªå· | |
| affiliation | string | æ‰€å±ï¼ˆãƒãƒ¼ãƒ /å­¦æ ¡åï¼‰ | |
| category | string | ã‚«ãƒ†ã‚´ãƒªï¼ˆç”·å­/å¥³å­ç­‰ï¼‰ | |
| comment | string | ã‚³ãƒ¡ãƒ³ãƒˆãƒ»å‚™è€ƒ | |
| target_1500m | string | ç›®æ¨™ã‚¿ã‚¤ãƒ ï¼ˆ1500mï¼‰å½¢å¼: MM:SS | |
| target_3000m | string | ç›®æ¨™ã‚¿ã‚¤ãƒ ï¼ˆ3000mï¼‰å½¢å¼: MM:SS | |
| target_5000m | string | ç›®æ¨™ã‚¿ã‚¤ãƒ ï¼ˆ5000mï¼‰å½¢å¼: MM:SS | |
| target_10000m | string | ç›®æ¨™ã‚¿ã‚¤ãƒ ï¼ˆ10000mï¼‰å½¢å¼: MM:SS | |
| target_half | string | ç›®æ¨™ã‚¿ã‚¤ãƒ ï¼ˆãƒãƒ¼ãƒ•ãƒãƒ©ã‚½ãƒ³ï¼‰å½¢å¼: H:MM:SS | |
| target_full | string | ç›®æ¨™ã‚¿ã‚¤ãƒ ï¼ˆãƒ•ãƒ«ãƒãƒ©ã‚½ãƒ³ï¼‰å½¢å¼: H:MM:SS | |
| is_deleted | boolean | è«–ç†å‰Šé™¤ãƒ•ãƒ©ã‚°ï¼ˆTRUE/FALSEï¼‰ | |

### 4.3 Recordsã‚·ãƒ¼ãƒˆï¼ˆç«¶æŠ€è¨˜éŒ²ï¼‰

| ã‚«ãƒ©ãƒ å | å‹ | èª¬æ˜ | å¿…é ˆ |
|----------|-----|------|------|
| record_id | string | è¨˜éŒ²IDï¼ˆUUIDï¼‰ | â—‹ |
| player_id | string | é¸æ‰‹IDï¼ˆPlayersã‚·ãƒ¼ãƒˆã¸ã®å¤–éƒ¨ã‚­ãƒ¼ï¼‰ | â—‹ |
| race_name | string | å¤§ä¼šå | â—‹ |
| date | string | æ—¥ä»˜ï¼ˆYYYY-MM-DDå½¢å¼ï¼‰ | â—‹ |
| section | string | ç¨®ç›®ï¼ˆ1500m, 5000m, ãƒãƒ¼ãƒ•ãƒãƒ©ã‚½ãƒ³ç­‰ï¼‰ | â—‹ |
| time | string | ã‚¿ã‚¤ãƒ ï¼ˆMM:SS or HH:MM:SSå½¢å¼ï¼‰ | â—‹ |
| memo | string | ãƒ¡ãƒ¢ | |
| created_at | string | ä½œæˆæ—¥æ™‚ï¼ˆISO8601å½¢å¼ï¼‰ | |
| updated_at | string | æ›´æ–°æ—¥æ™‚ï¼ˆISO8601å½¢å¼ï¼‰ | |

### 4.4 TeamRecordsã‚·ãƒ¼ãƒˆï¼ˆãƒãƒ¼ãƒ è¨˜éŒ²ï¼‰

â€»ç¾åœ¨ã®Streamlitç‰ˆã§ã¯æœªä½¿ç”¨

| ã‚«ãƒ©ãƒ å | å‹ | èª¬æ˜ |
|----------|-----|------|
| team_record_id | string | ID |
| race_name | string | å¤§ä¼šå |
| date | string | é–‹å‚¬æ—¥ |
| total_time | string | ç·åˆè¨˜éŒ² |
| rank | number | é †ä½ |
| memo | string | å‚™è€ƒ |

---

## 5. èªè¨¼ãƒ•ãƒ­ãƒ¼

### 5.1 ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆèªè¨¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Streamlit     â”‚â”€â”€â”€â”€â–¶â”‚  Service Account â”‚â”€â”€â”€â”€â–¶â”‚ Google Sheets   â”‚
â”‚   ã‚¢ãƒ—ãƒª         â”‚     â”‚  (JSON Key)      â”‚     â”‚ API             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 èªè¨¼æƒ…å ±ã®å–å¾—å„ªå…ˆé †ä½

```python
def get_credentials_info() -> dict:
    # 1. ç’°å¢ƒå¤‰æ•° GCP_KEY ãŒã‚ã‚Œã°ä½¿ç”¨ï¼ˆDocker/Cloud Run/HF Spacesç”¨ï¼‰
    gcp_key = os.environ.get("GCP_KEY")
    if gcp_key:
        return json.loads(gcp_key)

    # 2. ãªã‘ã‚Œã° st.secrets ã‚’ä½¿ç”¨ï¼ˆStreamlit Cloud/ãƒ­ãƒ¼ã‚«ãƒ«ç”¨ï¼‰
    return dict(st.secrets["gcp_service_account"])
```

### 5.3 ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆJSONå½¢å¼

```json
{
  "type": "service_account",
  "project_id": "ekiden-446714",
  "private_key_id": "xxxxx",
  "private_key": "-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n",
  "client_email": "ekiden-service@ekiden-446714.iam.gserviceaccount.com",
  "client_id": "xxxxx",
  "auth_uri": "https://accounts.google.com/o/oauth2/auth",
  "token_uri": "https://oauth2.googleapis.com/token",
  "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
  "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/..."
}
```

### 5.4 ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸ã®å…±æœ‰è¨­å®š

ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆ`client_email`ï¼‰ã‚’ã€å¯¾è±¡ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®å…±æœ‰è¨­å®šã§ã€Œç·¨é›†è€…ã€ã¨ã—ã¦è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

---

## 6. ãƒšãƒ¼ã‚¸ä»•æ§˜

### 6.1 ãƒ›ãƒ¼ãƒ ç”»é¢ï¼ˆapp.pyï¼‰

**ãƒ‘ã‚¹**: `/`

**Streamlitè¨­å®š**:
```python
st.set_page_config(
    page_title="é§…ä¼ãƒãƒ¼ãƒ ç®¡ç†",
    page_icon="ğŸƒ",
    layout="wide",
    initial_sidebar_state="expanded",
)
```

**æ©Ÿèƒ½**:
| æ©Ÿèƒ½ | èª¬æ˜ |
|------|------|
| ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦è¡¨ç¤º | åˆ©ç”¨å¯èƒ½ãªæ©Ÿèƒ½ã®èª¬æ˜ |
| æ¥ç¶šãƒ†ã‚¹ãƒˆ | ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§GCP_KEYç¢ºèªã€DBæ¥ç¶šç¢ºèª |
| ãƒ–ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°éè¡¨ç¤º | CSS/JSã§Streamlitãƒ­ã‚´ç­‰ã‚’éè¡¨ç¤º |

**UIè¦ç´ **:
- ã‚¿ã‚¤ãƒˆãƒ«: ã€Œé§…ä¼ãƒãƒ¼ãƒ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  v0.6ã€
- æ©Ÿèƒ½èª¬æ˜ãƒªã‚¹ãƒˆï¼ˆé¸æ‰‹ä¸€è¦§ã€é¸æ‰‹è©³ç´°ã€è¨˜éŒ²å…¥åŠ›ï¼‰
- æ¥ç¶šãƒ†ã‚¹ãƒˆãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹

---

### 6.2 é¸æ‰‹ä¸€è¦§ãƒšãƒ¼ã‚¸ï¼ˆpages/1_é¸æ‰‹ä¸€è¦§.pyï¼‰

**ãƒ‘ã‚¹**: `/é¸æ‰‹ä¸€è¦§`

**æ©Ÿèƒ½**:
| æ©Ÿèƒ½ | èª¬æ˜ |
|------|------|
| é¸æ‰‹ã‚«ãƒ¼ãƒ‰è¡¨ç¤º | 3ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã§ã‚«ãƒ¼ãƒ‰å½¢å¼è¡¨ç¤º |
| åå‰æ¤œç´¢ | éƒ¨åˆ†ä¸€è‡´ï¼ˆå¤§æ–‡å­—å°æ–‡å­—ç„¡è¦–ï¼‰ |
| æ‰€å±ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ | å®Œå…¨ä¸€è‡´ |
| ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ | å®Œå…¨ä¸€è‡´ |
| ãƒšãƒ¼ã‚¸é·ç§» | é¸æ‰‹è©³ç´°ãƒšãƒ¼ã‚¸ã¸é·ç§» |

**UIæ§‹æˆ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¸æ‰‹ä¸€è¦§                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [åå‰æ¤œç´¢    ] [æ‰€å±â–¼    ] [ã‚«ãƒ†ã‚´ãƒªâ–¼   ]           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ **XXå**ã®é¸æ‰‹                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ â”‚ é¸æ‰‹å     â”‚ â”‚ é¸æ‰‹å     â”‚ â”‚ é¸æ‰‹å     â”‚          â”‚
â”‚ â”‚ ç™»éŒ²ç•ªå·   â”‚ â”‚ ç™»éŒ²ç•ªå·   â”‚ â”‚ ç™»éŒ²ç•ªå·   â”‚          â”‚
â”‚ â”‚ æ‰€å±       â”‚ â”‚ æ‰€å±       â”‚ â”‚ æ‰€å±       â”‚          â”‚
â”‚ â”‚ ã‚«ãƒ†ã‚´ãƒª   â”‚ â”‚ ã‚«ãƒ†ã‚´ãƒª   â”‚ â”‚ ã‚«ãƒ†ã‚´ãƒª   â”‚          â”‚
â”‚ â”‚ [è©³ç´°ã‚’è¦‹ã‚‹]â”‚ â”‚ [è©³ç´°ã‚’è¦‹ã‚‹]â”‚ â”‚ [è©³ç´°ã‚’è¦‹ã‚‹]â”‚          â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ãƒ‡ãƒ¼ã‚¿å–å¾—**:
```python
df = get_players()  # ã‚­ãƒ£ãƒƒã‚·ãƒ¥TTL: 60ç§’
```

**ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å‡¦ç†**:
```python
# åå‰æ¤œç´¢
filtered = filtered[filtered["name"].str.contains(search, case=False, na=False)]

# æ‰€å±ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
if affiliation != "ã™ã¹ã¦":
    filtered = filtered[filtered["affiliation"] == affiliation]

# ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
if category != "ã™ã¹ã¦":
    filtered = filtered[filtered["category"] == category]
```

---

### 6.3 é¸æ‰‹è©³ç´°ãƒšãƒ¼ã‚¸ï¼ˆpages/2_é¸æ‰‹è©³ç´°.pyï¼‰

**ãƒ‘ã‚¹**: `/é¸æ‰‹è©³ç´°`

**æ©Ÿèƒ½**:
| æ©Ÿèƒ½ | èª¬æ˜ |
|------|------|
| é¸æ‰‹é¸æŠ | ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã¾ãŸã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³çµŒç”± |
| åŸºæœ¬æƒ…å ±è¡¨ç¤º | ç™»éŒ²ç•ªå·ã€æ‰€å±ã€ã‚«ãƒ†ã‚´ãƒªã€ã‚³ãƒ¡ãƒ³ãƒˆ |
| ç›®æ¨™ã‚¿ã‚¤ãƒ è¡¨ç¤º | 6ç¨®ç›®ã®ç›®æ¨™ã‚¿ã‚¤ãƒ  |
| è‡ªå·±ãƒ™ã‚¹ãƒˆè¡¨ç¤º | ç¨®ç›®åˆ¥ãƒ™ã‚¹ãƒˆã‚¿ã‚¤ãƒ ï¼ˆãƒ¡ãƒˆãƒªãƒƒã‚¯ã‚«ãƒ¼ãƒ‰ï¼‰ |
| è¨˜éŒ²æ¨ç§»ã‚°ãƒ©ãƒ• | PlotlyæŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ï¼ˆç¨®ç›®åˆ¥ï¼‰ |
| è¨˜éŒ²ä¸€è¦§ | DataFrameãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ—¥ä»˜é™é †ï¼‰ |

**UIæ§‹æˆ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [é¸æ‰‹ã‚’é¸æŠ â–¼                                    ]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é¸æ‰‹å                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŸºæœ¬æƒ…å ±                â”‚ ç›®æ¨™ã‚¿ã‚¤ãƒ                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ç™»éŒ²ç•ªå·: XXX      â”‚ â”‚ â”‚ 1500m: 4:30           â”‚ â”‚
â”‚ â”‚ æ‰€å±: â—‹â—‹é«˜æ ¡       â”‚ â”‚ â”‚ 3000m: 9:00           â”‚ â”‚
â”‚ â”‚ ã‚«ãƒ†ã‚´ãƒª: ç”·å­     â”‚ â”‚ â”‚ 5000m: 15:30          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è‡ªå·±ãƒ™ã‚¹ãƒˆ                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚ â”‚ 1500m  â”‚ â”‚ 3000m  â”‚ â”‚ 5000m  â”‚ â”‚ 10000m â”‚        â”‚
â”‚ â”‚ 4:25   â”‚ â”‚ 8:55   â”‚ â”‚ 15:20  â”‚ â”‚ 32:00  â”‚        â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¨˜éŒ²æ¨ç§»                                            â”‚
â”‚ [ç¨®ç›®ã‚’é¸æŠ â–¼]                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚         ğŸ“ˆ PlotlyæŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•                    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¨˜éŒ²ä¸€è¦§                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ â”‚ æ—¥ä»˜  â”‚ å¤§ä¼šå  â”‚ ç¨®ç›® â”‚ ã‚¿ã‚¤ãƒ  â”‚ ãƒ¡ãƒ¢ â”‚          â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ã‚°ãƒ©ãƒ•ä»•æ§˜**:
```python
fig = px.line(
    section_records,
    x="date",
    y="seconds",
    markers=True,
    title=f"{selected_section} è¨˜éŒ²æ¨ç§»",
    labels={"date": "æ—¥ä»˜", "seconds": "ã‚¿ã‚¤ãƒ ï¼ˆç§’ï¼‰"},
    hover_data=["race_name", "time"],
)
fig.update_layout(hovermode="x unified")
```

---

### 6.4 è¨˜éŒ²å…¥åŠ›ãƒšãƒ¼ã‚¸ï¼ˆpages/3_è¨˜éŒ²å…¥åŠ›.pyï¼‰

**ãƒ‘ã‚¹**: `/è¨˜éŒ²å…¥åŠ›`

**æ©Ÿèƒ½**:
| æ©Ÿèƒ½ | èª¬æ˜ |
|------|------|
| é¸æ‰‹é¸æŠ | ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ |
| è¨˜éŒ²å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  | å¤§ä¼šåã€æ—¥ä»˜ã€ç¨®ç›®ã€ã‚¿ã‚¤ãƒ ã€ãƒ¡ãƒ¢ |
| ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ | å¤§ä¼šåãƒ»ã‚¿ã‚¤ãƒ å¿…é ˆãƒã‚§ãƒƒã‚¯ |
| ç™»éŒ²å‡¦ç† | ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸è¿½åŠ  |

**UIæ§‹æˆ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¨˜éŒ²å…¥åŠ›                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [é¸æ‰‹ â–¼                                          ]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¤§ä¼šå                  â”‚ ç¨®ç›®                       â”‚
â”‚ [                    ] â”‚ [â–¼                      ]  â”‚
â”‚                        â”‚                            â”‚
â”‚ æ—¥ä»˜                    â”‚ ã‚¿ã‚¤ãƒ                      â”‚
â”‚ [ğŸ“…                  ] â”‚ [                       ]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ãƒ¡ãƒ¢                                                â”‚
â”‚ [                                                ]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [          è¨˜éŒ²ã‚’ç™»éŒ²          ]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…¥åŠ›é …ç›®**:

| é …ç›® | UIè¦ç´  | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ |
|------|--------|---------------|-------------|
| é¸æ‰‹ | st.selectbox | å¿…é ˆ | æœ€åˆã®é¸æ‰‹ |
| å¤§ä¼šå | st.text_input | å¿…é ˆ | - |
| æ—¥ä»˜ | st.date_input | å¿…é ˆ | ä»Šæ—¥ |
| ç¨®ç›® | st.selectbox | å¿…é ˆ | 1500m |
| ã‚¿ã‚¤ãƒ  | st.text_input | å¿…é ˆã€å½¢å¼: MM:SS or HH:MM:SS | - |
| ãƒ¡ãƒ¢ | st.text_area | ä»»æ„ | - |

**ç¨®ç›®é¸æŠè‚¢**:
- 1500m
- 3000m
- 5000m
- 10000m
- ãƒãƒ¼ãƒ•ãƒãƒ©ã‚½ãƒ³
- ãƒ•ãƒ«ãƒãƒ©ã‚½ãƒ³
- ãã®ä»–ï¼ˆãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã«åˆ‡æ›¿ï¼‰

**ç™»éŒ²å‡¦ç†**:
```python
add_record(
    player_id=player_id,
    race_name=race_name,
    date=race_date.isoformat(),
    section=section,
    time=time_input,
    memo=memo,
)
```

---

## 7. API/é–¢æ•°ä»•æ§˜

### 7.1 sheets.py - Google Spreadsheetsæ¥ç¶šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

#### get_credentials_info() -> dict
| é …ç›® | å†…å®¹ |
|------|------|
| èª¬æ˜ | èªè¨¼æƒ…å ±ã‚’å–å¾—ï¼ˆç’°å¢ƒå¤‰æ•°å„ªå…ˆã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§st.secretsï¼‰ |
| å¼•æ•° | ãªã— |
| æˆ»ã‚Šå€¤ | ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆJSONè¾æ›¸ |

#### get_client() -> gspread.Client
| é …ç›® | å†…å®¹ |
|------|------|
| èª¬æ˜ | èªè¨¼æ¸ˆã¿gspreadã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å–å¾— |
| ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ | `@st.cache_resource` |
| æˆ»ã‚Šå€¤ | gspread.Client |

#### get_spreadsheet() -> gspread.Spreadsheet
| é …ç›® | å†…å®¹ |
|------|------|
| èª¬æ˜ | ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’å–å¾— |
| ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ | `@st.cache_resource` |
| æˆ»ã‚Šå€¤ | gspread.Spreadsheet |

#### get_players() -> pd.DataFrame
| é …ç›® | å†…å®¹ |
|------|------|
| èª¬æ˜ | é¸æ‰‹ä¸€è¦§ã‚’å–å¾— |
| ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ | `@st.cache_data(ttl=60)` |
| ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ | `is_deleted != True` |
| æˆ»ã‚Šå€¤ | pd.DataFrame |

#### get_player_by_id(player_id: str) -> Optional[dict]
| é …ç›® | å†…å®¹ |
|------|------|
| èª¬æ˜ | é¸æ‰‹è©³ç´°ã‚’å–å¾— |
| ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ | `@st.cache_data(ttl=60)` |
| å¼•æ•° | player_id: é¸æ‰‹ID |
| æˆ»ã‚Šå€¤ | é¸æ‰‹æƒ…å ±è¾æ›¸ or None |

#### get_records(player_id: Optional[str] = None) -> pd.DataFrame
| é …ç›® | å†…å®¹ |
|------|------|
| èª¬æ˜ | è¨˜éŒ²ä¸€è¦§ã‚’å–å¾— |
| ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ | `@st.cache_data(ttl=60)` |
| å¼•æ•° | player_id: é¸æ‰‹IDï¼ˆçœç•¥æ™‚ã¯å…¨ä»¶ï¼‰ |
| æˆ»ã‚Šå€¤ | pd.DataFrame |

#### get_team_records() -> pd.DataFrame
| é …ç›® | å†…å®¹ |
|------|------|
| èª¬æ˜ | ãƒãƒ¼ãƒ è¨˜éŒ²ã‚’å–å¾—ï¼ˆç¾åœ¨æœªä½¿ç”¨ï¼‰ |
| ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ | `@st.cache_data(ttl=60)` |
| æˆ»ã‚Šå€¤ | pd.DataFrame |

#### add_record(player_id, race_name, date, section, time, memo="") -> bool
| é …ç›® | å†…å®¹ |
|------|------|
| èª¬æ˜ | è¨˜éŒ²ã‚’è¿½åŠ  |
| å¼•æ•° | player_id, race_name, date, section, time, memo |
| å‡¦ç† | UUIDã§record_idç”Ÿæˆã€created_at/updated_atè¨­å®šã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ |
| æˆ»ã‚Šå€¤ | Trueï¼ˆæˆåŠŸæ™‚ï¼‰ |

#### calculate_best_records(records_df: pd.DataFrame) -> dict
| é …ç›® | å†…å®¹ |
|------|------|
| èª¬æ˜ | ç¨®ç›®åˆ¥ãƒ™ã‚¹ãƒˆã‚¿ã‚¤ãƒ ã‚’è¨ˆç®— |
| å¼•æ•° | records_df: è¨˜éŒ²DataFrame |
| æˆ»ã‚Šå€¤ | `{section: {time, seconds, date, race_name}}` |

#### time_to_seconds(time_str: str) -> Optional[float]
| é …ç›® | å†…å®¹ |
|------|------|
| èª¬æ˜ | æ™‚é–“æ–‡å­—åˆ—ã‚’ç§’ã«å¤‰æ› |
| å¯¾å¿œå½¢å¼ | `MM:SS`, `HH:MM:SS` |
| æˆ»ã‚Šå€¤ | ç§’æ•° or None |

#### seconds_to_time(seconds: float) -> str
| é …ç›® | å†…å®¹ |
|------|------|
| èª¬æ˜ | ç§’ã‚’æ™‚é–“æ–‡å­—åˆ—ã«å¤‰æ› |
| æˆ»ã‚Šå€¤ | `MM:SS.ss` or `H:MM:SS.ss` |

---

### 7.2 style.py - å…±é€šã‚¹ã‚¿ã‚¤ãƒ«

#### hide_streamlit_branding()
| é …ç›® | å†…å®¹ |
|------|------|
| èª¬æ˜ | Streamlitã®ãƒ–ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°è¦ç´ ã‚’éè¡¨ç¤º |
| éè¡¨ç¤ºå¯¾è±¡ | MainMenu, footer, header, ãƒ„ãƒ¼ãƒ«ãƒãƒ¼, ViewerBadge, Manage appãƒœã‚¿ãƒ³ |

---

## 8. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

### 8.1 requirements.txt

```
streamlit>=1.28.0
gspread>=5.12.0
google-auth>=2.23.0
pandas>=2.0.0
plotly>=5.18.0
```

### 8.2 .streamlit/config.toml

```toml
[theme]
primaryColor = "#1E88E5"        # ãƒ—ãƒ©ã‚¤ãƒãƒªã‚«ãƒ©ãƒ¼ï¼ˆé’ï¼‰
backgroundColor = "#FFFFFF"      # èƒŒæ™¯è‰²ï¼ˆç™½ï¼‰
secondaryBackgroundColor = "#F5F5F5"  # ã‚»ã‚«ãƒ³ãƒ€ãƒªèƒŒæ™¯ï¼ˆè–„ç°ï¼‰
textColor = "#212121"           # ãƒ†ã‚­ã‚¹ãƒˆè‰²ï¼ˆé»’ï¼‰
font = "sans serif"             # ãƒ•ã‚©ãƒ³ãƒˆ

[server]
headless = true                 # ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ¢ãƒ¼ãƒ‰

[client]
toolbarMode = "viewer"          # ãƒ„ãƒ¼ãƒ«ãƒãƒ¼éè¡¨ç¤º
showErrorDetails = false        # ã‚¨ãƒ©ãƒ¼è©³ç´°éè¡¨ç¤º

[browser]
gatherUsageStats = false        # ä½¿ç”¨çµ±è¨ˆç„¡åŠ¹
```

### 8.3 Dockerfile

```dockerfile
FROM python:3.9-slim

WORKDIR /app

# ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
COPY streamlit_app/requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚³ãƒ”ãƒ¼
COPY streamlit_app/ .

# Cloud Runç”¨ãƒãƒ¼ãƒˆï¼ˆç’°å¢ƒå¤‰æ•°PORTã‚’ä½¿ç”¨ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ8080ï¼‰
EXPOSE 8080

# Streamlitè¨­å®š
ENV STREAMLIT_SERVER_ADDRESS=0.0.0.0
ENV STREAMLIT_SERVER_HEADLESS=true

# èµ·å‹•ã‚³ãƒãƒ³ãƒ‰ï¼ˆCloud Runã®PORTç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨ï¼‰
CMD streamlit run app.py --server.port=${PORT:-8080} --server.address=0.0.0.0
```

---

## 9. ç’°å¢ƒå¤‰æ•°

| å¤‰æ•°å | ç”¨é€” | è¨­å®šå ´æ‰€ | å½¢å¼ |
|--------|------|----------|------|
| GCP_KEY | ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆJSON | Cloud Run / HF Spaces | JSONæ–‡å­—åˆ— |
| PORT | ã‚µãƒ¼ãƒãƒ¼ãƒãƒ¼ãƒˆ | Cloud Runï¼ˆè‡ªå‹•è¨­å®šï¼‰ | æ•°å€¤ |
| STREAMLIT_SERVER_ADDRESS | ãƒªãƒƒã‚¹ãƒ³ã‚¢ãƒ‰ãƒ¬ã‚¹ | Dockerfile | IPã‚¢ãƒ‰ãƒ¬ã‚¹ |
| STREAMLIT_SERVER_HEADLESS | ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ¢ãƒ¼ãƒ‰ | Dockerfile | true/false |

---

## 10. ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### 10.1 ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º

**å‰ææ¡ä»¶**:
- Python 3.9+
- `.streamlit/secrets.toml` ã«gcp_service_accountã‚’è¨­å®š

**èµ·å‹•ã‚³ãƒãƒ³ãƒ‰**:
```bash
cd streamlit_app
streamlit run app.py
```

**secrets.tomlå½¢å¼**:
```toml
[gcp_service_account]
type = "service_account"
project_id = "ekiden-446714"
private_key_id = "xxxxx"
private_key = "-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"
client_email = "ekiden-service@ekiden-446714.iam.gserviceaccount.com"
client_id = "xxxxx"
auth_uri = "https://accounts.google.com/o/oauth2/auth"
token_uri = "https://oauth2.googleapis.com/token"
auth_provider_x509_cert_url = "https://www.googleapis.com/oauth2/v1/certs"
client_x509_cert_url = "https://www.googleapis.com/robot/v1/metadata/x509/..."
```

---

### 10.2 Streamlit Community Cloud

**æ‰‹é †**:
1. GitHubãƒªãƒã‚¸ãƒˆãƒªã‚’æ¥ç¶š
2. Main file path: `streamlit_app/app.py`
3. Secretsè¨­å®šã§`gcp_service_account`ã‚’è¨­å®šï¼ˆTOMLå½¢å¼ï¼‰
4. Deploy

**æ³¨æ„äº‹é …**:
- ãƒ¢ãƒã‚¤ãƒ«ã§ãƒ–ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒãƒƒã‚¸ãŒå®Œå…¨ã«æ¶ˆã›ãªã„
- ç„¡æ–™ãƒ—ãƒ©ãƒ³ã§ã¯ä¸€å®šæ™‚é–“å¾Œã«ã‚¹ãƒªãƒ¼ãƒ—

---

### 10.3 Hugging Face Spaces

**æ‰‹é †**:
1. Dockerfileã‚’ä½¿ç”¨ï¼ˆsdk: dockerï¼‰
2. README.mdã«YAMLãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼ã‚’è¨­å®š
3. Settings â†’ Variables and secretsã§`GCP_KEY`ã‚’è¨­å®š
4. JSONã¯1è¡Œã§è²¼ã‚Šä»˜ã‘ï¼ˆæ”¹è¡Œãªã—ï¼‰

**README.mdå½¢å¼**:
```markdown
---
title: é§…ä¼ãƒãƒ¼ãƒ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
emoji: ğŸƒ
colorFrom: blue
colorTo: green
sdk: docker
pinned: false
---
```

**æ³¨æ„äº‹é …**:
- ç’°å¢ƒå¤‰æ•°ãŒåæ˜ ã•ã‚Œãªã„å ´åˆã¯Factory rebootå¿…è¦
- ãƒ¢ãƒã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ã§404ã«ãªã‚‹å ´åˆã‚ã‚Š

---

### 10.4 Google Cloud Runï¼ˆæ¨å¥¨ï¼‰

**å‰ææ¡ä»¶**:
- Google Cloud ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- gcloud CLI ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿
- èª²é‡‘æœ‰åŠ¹åŒ–ï¼ˆå¾“é‡åˆ¶ã€ä½ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãªã‚‰ç„¡æ–™æ å†…ï¼‰

**ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †**:

```bash
# 1. ãƒ­ã‚°ã‚¤ãƒ³
gcloud auth login

# 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
gcloud config set project ekiden-446714

# 3. APIæœ‰åŠ¹åŒ–
gcloud services enable \
  run.googleapis.com \
  artifactregistry.googleapis.com \
  cloudbuild.googleapis.com

# 4. ãƒ“ãƒ«ãƒ‰ï¼†ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆã‚½ãƒ¼ã‚¹ã‹ã‚‰ï¼‰
gcloud run deploy ekiden-app \
  --source . \
  --region asia-northeast1 \
  --allow-unauthenticated \
  --set-env-vars "GCP_KEY=$(cat service-account.json | tr -d '\n')"
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- ãƒ–ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãªã—
- å¾“é‡èª²é‡‘ï¼ˆä½ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãªã‚‰ç„¡æ–™æ å†…ï¼‰
- è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
- Googleã‚µãƒ¼ãƒ“ã‚¹ã¨ã®ç›¸æ€§è‰¯å¥½

**æ³¨æ„äº‹é …**:
- ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆæ™‚ã«æ•°ç§’ã®èµ·å‹•æ™‚é–“
- ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ç™»éŒ²å¿…è¦

---

## 11. æ—¢çŸ¥ã®å•é¡Œãƒ»åˆ¶é™

### 11.1 Streamlit Community Cloud
| å•é¡Œ | çŠ¶æ…‹ |
|------|------|
| ãƒ¢ãƒã‚¤ãƒ«ã§ã®èµ¤ã„ãƒãƒƒã‚¸ï¼ˆHosted with Streamlitï¼‰ãŒCSSã§å®Œå…¨ã«æ¶ˆã›ãªã„ | æœªè§£æ±º |

### 11.2 Hugging Face Spaces
| å•é¡Œ | çŠ¶æ…‹ |
|------|------|
| ç’°å¢ƒå¤‰æ•°GCP_KEYã®è¨­å®šãŒåæ˜ ã•ã‚Œãªã„å ´åˆãŒã‚ã‚‹ | æœªè§£æ±ºï¼ˆFactory rebootå¿…è¦ï¼‰ |
| ãƒ¢ãƒã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ã§404ã«ãªã‚‹å ´åˆãŒã‚ã‚‹ | èª¿æŸ»ä¸­ |

### 11.3 ä¸€èˆ¬çš„ãªåˆ¶é™
| åˆ¶é™ | è©³ç´° |
|------|------|
| ã‚­ãƒ£ãƒƒã‚·ãƒ¥TTL | 60ç§’ã®ãŸã‚ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã§ã¯ãªã„ |
| ã‚¿ã‚¤ãƒ å½¢å¼ | `MM:SS`ã¾ãŸã¯`HH:MM:SS`ã®ã¿å¯¾å¿œ |
| åŒæ™‚ç·¨é›† | è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åŒæ™‚ç·¨é›†æ™‚ã«ç«¶åˆã®å¯èƒ½æ€§ |

---

## 12. ä»Šå¾Œã®æ‹¡å¼µæ¡ˆ

| å„ªå…ˆåº¦ | æ©Ÿèƒ½ | èª¬æ˜ |
|--------|------|------|
| é«˜ | é¸æ‰‹ã®æ–°è¦ç™»éŒ²ãƒ»ç·¨é›†æ©Ÿèƒ½ | Adminæ©Ÿèƒ½ã®ç§»æ¤ |
| é«˜ | è¨˜éŒ²ã®ç·¨é›†ãƒ»å‰Šé™¤æ©Ÿèƒ½ | èª¤å…¥åŠ›ã®ä¿®æ­£å¯¾å¿œ |
| ä¸­ | ãƒãƒ¼ãƒ è¨˜éŒ²ãƒšãƒ¼ã‚¸ | TeamRecordsã‚·ãƒ¼ãƒˆã®æ´»ç”¨ |
| ä¸­ | CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ | ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— |
| ä½ | åŒºé–“ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | GASç‰ˆã®D&Dæ©Ÿèƒ½ã®ç§»æ¤ |
| ä½ | ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ | é–²è¦§æ¨©é™ç®¡ç† |

---

## å¤‰æ›´å±¥æ­´

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | å¤‰æ›´å†…å®¹ |
|------------|------|----------|
| v0.6 | 2025-12-07 | GASã‹ã‚‰Streamlitç§»è¡Œã€åˆæœŸå®Ÿè£…ã€ä»•æ§˜æ›¸ä½œæˆ |
